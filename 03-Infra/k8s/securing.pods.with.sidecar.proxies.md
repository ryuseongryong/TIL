# Securing Pods with Sidecar proxies
- https://medium.com/@lukas.eichler/securing-pods-with-sidecar-proxies-d84f8d34be3e

- 애플리케이션이 k8s에 파드로 배포되는 경우, 다른 모든 파드에서 접근할 수 있도록 설계되어 있다. 애플리케이션이 강력한 인증 및 권한 부여 메커니즘을 제공하다면 괜찮다. 그렇지 않으면 k8s의 다른 워크로드는 어떤 형태의 인증 없이도 애플리케이션과 통신할 수 있다. 클러스터의 모든 워크로드가 신뢰할 수 있고 인증이 필요하지 않더라도 모든 워크로드가 이 보안되지 않은 애플리케이션의 게이트웨이로 사용될 수 있다.
- 공유 플랫 네트워크를 통해 동일한 클러스터에서 다양한 워크로드를 실행하면 큰 이점이 있지만 업데이트된 보안 모델도 필요하다. 이전에는 애플리케이션을 캡슐화하고 이러한 애플리케이션에 대한 인증뿐만 아니라 로드 밸런싱을 제공하기 위해 nginx와 같은 리버스 프록시를 사용하는 경우가 많았다.
- k8s는 k8s 서비스를 구성하여 로드밸런싱을 정의하는 간단한 방법을 제공한다. 그러나 이전에 리버스 프록시로 제공되던 인증 기능은 k8s 서비스에서 제공할 수 없다. 따라서 공유 k8s에서 자체 인증 메커니즘이 없는 애플리케이션에 인증을 제공하려면 새로운 접근 방식이 필요하다.

- 이 문제에 대한 한 가지 해결책은 사이드카 컨테이너로 애플리케이션과 동일한 파드의 애플리케이션 앞쪽에서 리버스 프록시를 실행하는 것이다. 이는 istio가 서비스 엔드포인트 간에 인증 및 권한 부여를 제공하기 위해 사용하는 것과 동일한 모델이다.
- istio는 파드 내부에 Envoy 프록시를 주입한다. 그러나 사이드카 프록시 패턴을 사용하기 위해 전체 서비스 메시를 운영할 필요는 없다. 대신 애플리케이션과 동일한 파드에 사이드카 컨테이너로 프록시 소프트웨어를 배포할 수 있다. 동일한 파드의 모든 컨테이너는 동일한 가상 네트워크 장치를 공유하기 때문에 네트워크를 통해 서로 안전하게 통신할 수 있다. 따라서 사이드카 프록시를 파드 외부에만 노출하고 프록시와 애플리케이션 간에 안전한 네트워크 연결을 제공할 수 있다. 그러면 사이드카 프록시는 요청을 애플리케이션에 전달하기 전에 모든 요청을 인증한다.
- 인증 외에도 사이드카 프록시는 TLS를 지원하지 않는 애플리케이션을 위해 TLS 암호화를 제공할 수 있다. 프록시는 TLS 엔드포인트를 제공하고, TLS 세션을 종료하고, TLS가 아닌 트래픽을 애플리케이션으로 전달할 수 있다.

## Kubernetes Sidecar proxy deployment
- 사이드카 프록시 패턴은 인증 자체 없이 애플리케이션에 대한 기본 인증을 제공하는 데 사용된다. 프록시에는 포트 0.0.0.0:80에 컨테이너 포트가 노출되어 있으며 다른 파드에서 사용할 수 있다. 애플리케이션 컨테이너에는 컨테이너 파드가 노출되지 않으며 포트 127.0.0.1:8080의 루프백 장치에서 요청만 수신한다.