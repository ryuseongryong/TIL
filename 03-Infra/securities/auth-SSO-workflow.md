# Authentication and authorization: The key to single sign-on(SSO) workflow
- https://www.redhat.com/architect/authentication-and-authorization

- 타사 ID 공급업체를 통해 사용자가 싱글 사인온을 즐기고 공급업체는 가장 잘 제공하는 서비스에 집중할 수 있도록 하는 방법.
- 엔터프라이즈 수준의 싱글 사인온(SS0) 기술은 한동안 사용되어 왔다. 직원들이 일상 업무에 사용하는 수많은 애플리케이션마다 특별한 로그인 자격 증명을 유지하도록 요구하는 것은 번거로울 뿐만 아니라 비효율적이었다.
- 다행히도 LDAP 및 Active Directory와 같은 기술을 통해 사용자는 하나의 로그인 자격 증명 세트를 유지하여 통합 인증 환경을 구현할 수 있었다. 이러한 기술은 모든 애플리케이션이 기업의 프라이빗 경계 내에 있는 한 잘 작동했다. Salesforce 및 WebEx와 같은 외부 애플리케이션이 기업에서 보편화됨에 따라 애플리케이션에 대한 액세스를 허용하는 새로운 방법이 필요했다. 해결책은 타사 ID 공급자 간의 통신을 허용하는 새로운 로그인 프로토콜을 사용하는 것이었다.
- SAML(보안 어설션 마크업 언어)은 새로운 프로토콜 중 첫 번째 프로토콜 중 하나였다. 곧이어 OAuth가 등장했고 OpenID도 등장했다. 이러한 프로토콜은 사용자가 외부 애플리케이션에 액세스할 수 있는 새로운 방법을 제공할 뿐만 아니라 사용자 정보에 대한 액세스 권한을 부여하는 새로운 기술도 만들었다.
- 과거에는 직접 인증에 따라 모든 액세스 권한이 부여되었다. 사용자가 애플리케이션 양식에 사용자 이름/비밀번호 쌍을 직접 입력하여 액세스 권한을 얻었다. 오늘날 SAML, OAuth 및 OpenID에서는 애플리케이션에 대한 액세스가 ID 공급자(IdP)라고 하는 타사 인증 메커니즘을 사용하여 이루어진다. ID 공급자는 사용자를 대신하여 요청 당사자에게 특정 사용자의 정보에 대한 액세스 권한을 부여할 수도 있다.
- 이 도움말에서는 직접 인증과 타사 인증의 차이점에 대해 살펴보겠다. 또한 타사 인증을 사용하여 외부 웹사이트에 ID 공급업체에 저장된 사용자 정보에 대한 액세스 권한을 부여하는 방법에 대해서도 설명한다.

## understanding direct authentication
- 직접 인증은 사용자 또는 서비스가 사용자 이름/비밀번호 쌍 또는 특수 액세스 토큰을 사용하여 네트워크 또는 도메인에 로그인하는 프로세스이다. 직접 인증은 다중 사용자 시스템이 존재한 이래로 오랫동안 사용되어 왔다.

- 직접 인증 시나리오에서 사용자 액세스 자격 증명은 안전한 위치(일반적으로 자격 증명 액세스가 필요한 애플리케이션 내의 데이터베이스)에 저장된다. 일반적으로 사용자 이름과 비밀번호 또는 토큰과 같은 자격 증명은 암호화된 형식으로 저장되므로 보안 침해 발생 시 악의적인 공격자가 악의적인 목적으로 보안 데이터를 사용하지 못하도록 방지할 수 있다.

- 그림 1은 가상의 웹사이트인 빅 소셜 네트워크에 대한 직접 인증의 개념적 구현 예시를 보여준다.
    - `user <-> login page <-> server <-> DB`
    - 그림 1: 직접 인증에서는 사용자가 보안에 민감한 사용자 이름과 비밀번호를 사용하여 웹사이트에 직접 로그인한다.
- 빅 소셜 네트워크는 소셜 네트워크일 뿐만 아니라 자체 인증 제공자이기도 하다. 따라서, 빅 소셜 네트워크의 모든 사용자 이름과 비밀번호 관리는 빅 소셜 네트워크의 자체 신원 관리 기능을 통해 이루어진다. 즉, 빅 소셜 네트워크는 자체 신원 제공자이다.

- ID 공급자(IdP)라는 개념은 타사 인증을 고려할 때 중요한 개념으로, SAML, OAuth, OpenID가 그 예이다. ID 공급자는 타사 인증을 가능하게 하여 인터넷의 모든 애플리케이션이나 서비스가 ID 공급자의 인증 기능을 활용할 수 있도록 한다.

## Understanding third-party authentication
- 위에서 언급했듯이 타사 인증을 사용하면 인터넷의 모든 애플리케이션이나 서비스가 다른 웹사이트의 인증 서비스를 자신의 이익을 위해 사용할 수 있다. 운영적으로 이는 가상의 사이트인 Bob's Books와 같은 웹사이트가 ID 관리를 지원하는 다른 웹사이트에 액세스를 위임할 수 있음을 의미한다.

- 다시 말해, 밥스북스는 사용자에게 사용자 이름과 비밀번호를 등록하도록 요청하고 등록에 따른 모든 것을 관리하는 대신, 빅 소셜 네트워크의 인증 기능에 의존하여 작업을 수행할 수 있다. 그림 2는 워크플로우를 보여준다. 자세한 내용은 다음과 같다.

- 그림 2: 사용자가 인증을 위해 알려진 타사에 사용자 이름과 비밀번호를 제출합니다.
    - user <-> service login page <-> [big social network authentication login page <-> server <-> DB ]
    - 위의 그림 2는 Bob's Books가 Big Social Network의 ID 공급자 기능을 사용하여 자체 사이트에 대한 보안 로그인을 지원하는 방법을 보여준다. 프로세스의 세부 사항을 논의하기 전에 Bob's Books가 Big Social Network를 사용하려면 두 엔티티가 서로에 대해 알아야 한다는 점을 이해하는 것이 중요하다.

- 밥스북스는 사용자를 인증하기 위해 빅 소셜 네트워크를 사용하기로 결정하고 빅 소셜 네트워크에 소셜 미디어 사이트의 로그인 기능을 활용할 수 있는 권한을 요청하는 공식 요청서를 보냈다. (운영 수준에서 밥스북스는 빅 소셜 네트워크 로그인을 지원하기 위한 방법으로 OAuth2를 사용하기로 결정했다. OAuth2에 대한 자세한 내용은 여기에서 확인할 수 있다.)

- 밥스북스의 요청을 받은 빅 소셜 네트워크는 밥스북스가 정품인지 확인하는 작업을 수행했다. 확인이 완료된 후, 빅 소셜 네트워크는 밥스북스에 밥스북스만의 고유한 방식으로 빅 소셜 네트워크 로그인 페이지에 액세스할 수 있는 프로세스를 제공했다. 또한 밥스북스는 빅 소셜 네트워크 로그인에 성공하면 빅 소셜 네트워크에 응답할 수 있는 방법을 빅 소셜 네트워크에 제공했다. 즉, 타사 인증이 수행되기 전에도 Bob's Books와 Big Social Network는 서로에 대해 잘 알고 있어야 했다.

- 위의 그림 2에 표시된 타사 인증의 실제 메커니즘은 다음과 같습니다. 
    1. Mary가 bobsbooks.com에 방문한다. 
    2. 그녀는 밥스북스에 대해 잘 알지 못하기 때문에 빅 소셜 네트워크를 사용하여 사이트에 로그인할 수 있음을 알려주는 웹 페이지가 표시된다. (그림 2, 콜아웃 1) 
    3. Mary는 "로그인" 버튼을 클릭하고 Big Social Network로 표시되는 URL로 리디렉션된다. 
    4. 빅 소셜 네트워크 URL에는 밥의 책을 식별하는 토큰이 추가된다. 
    5. 빅 소셜 네트워크는 URL을 파싱하여 요청이 밥스북스를 대신하여 이루어진 것임을 확인한 다음, 메리가 밥스북스를 대신하여 빅 소셜 네트워크에 로그인할 수 있는 웹페이지를 표시한다. 
    6. Mary는 사용자 이름과 비밀번호를 입력한다.

- Mary는 Big Social Network를 통해 Bob's Books에 인증했다. 다음 단계는 Big Social Network가 Mary에 대한 정보를 Bob's Books와 공유하도록 허용하는 것이다. 이때 인증이 중요한 역할을 한다.

## Understanding third-party authorization
- 권한 부여는 제3자가 정보에 액세스하거나 다른 엔터티와 관련된 작업을 수행할 수 있는 권한을 부여하는 프로세스이다. 제3자 권한 부여의 예로는 Mary가 Big Social Network에서 Bob's Books가 자신의 Big Social Network 친구들의 이메일 주소에 액세스할 수 있도록 허용하는 것을 들 수 있다.

- 이 예에서 권한 부여는 특정 정보 보기에 국한된다. 그러나 다른 작업을 승인할 수 있는 경우도 있다. 예를 들어, Mary는 Bob's Books가 자신의 Big Social Network 담벼락에 게시할 수 있도록 허용한다.

- 아래 그림 3은 위의 그림 2에서 설명한 인증 프로세스에 권한 부여가 포함된 경우를 보여준다. 아래 그림 3의 콜아웃 1은 위 그림 2의 콜아웃 2가 중단된 지점에서 시작한다. 하지만 인증 프로세스를 진행하기 전에 앞서 공유하지 않은 중요한 정보를 추가해야 한다.

- 밥스북스는 빅 소셜 네트워크를 사용하여 사용자를 인증하기로 결정하면서 로그인 프로세스의 일부로 Mary에게 친구들의 모든 이메일 주소에 액세스할 수 있는 권한을 요청하기로 했다. 친구의 이메일 주소에 대한 액세스 권한을 제공하는 것은 인증을 위한 필수 사항은 아니다. 이는 임의적인 요청이므로 Mary가 거부할 수 있지만 여전히 로그인 프로세스의 일부이다.

- 그림 3: 사용자는 가상의 사이트인 Big Social Network와 같은 제3자가 자신의 개인 데이터 일부 또는 전부를 공유하도록 승인할 수 있습니다.
    1. Mary는 Bob's Books에서 Big Social Network로 리디렉션되어 사용자 이름과 비밀번호를 입력한다. 
    2. Big Social Network는 Mary의 자격 증명을 가져와서 ID 데이터베이스에 저장된 사용자 이름 및 비밀번호와 비교한다. 자격 증명이 일치한다. 
    Big Social Network는 Mary를 알고 있고 Bob's Books가 Mary의 친구들의 이메일 주소에 액세스하기를 원한다는 것을 알고 있기 때문에 Mary가 정말로 이메일 주소를 Bob's Books와 공유할 것인지 묻는 Big Social Network의 웹 페이지가 표시된다.
    3. Mary는 이메일 주소를 공유할 수 있는 권한을 Big Social Network에 부여한다. 그런 다음 빅 소셜 네트워크는 메리를 밥의 책으로 다시 리디렉션한다. 
    리디렉션의 일부로, 빅 소셜 네트워크는 Bob's Books의 URL에 메리가 실제로 빅 소셜 네트워크에 알려져 있음을 나타내는 토큰을 삽입한다. 밥스북스는 메리가 웹사이트에 액세스할 수 있도록 허용한다.

    - 여기서 Mary의 인증을 확인하는 정보가 Bob's Books로 다시 전달되는 방식은 사용되는 로그인 기술에 따라 다르다는 점에 유의해야 한다. 
    - SAML은 한 가지 방식으로, OAuth2는 다른 방식으로, OpenId는 세 번째 방식으로 수행한다. 어떤 방법을 사용하든 중요한 것은 Bob's Books가 Mary의 사용자 이름과 비밀번호를 알지 못한다는 것이다. 이러한 보안에 민감한 정보는 ID 공급자(이 경우 Big Social Network)에만 국한된다.
    - Bob's Books가 Mary에게 도메인에 대한 액세스 권한을 부여하면 수행해야 할 작업이 하나 더 있다. 밥스북스는 메리 친구들의 이메일 주소를 확보해야 한다. 이 작업은 밥의 책과 빅 소셜 네트워크 사이에서 백그라운드에서 수행된다.

    4. Big Social Network는 Mary가 친구들의 이메일 주소에 대한 액세스 권한을 Bob's Books에 부여했다는 사실을 알고 있다. 또한 인증 프로세스 중에 교환되는 데이터의 일부는 Bob's Books가 Big Social Network에서 Mary의 친구들의 이메일 주소를 가져오는 데 사용할 수 있는 정보이다. 따라서 밥스북스의 백엔드 서버에 있는 인텔리전스가 빅 소셜 네트워크의 백엔드 서버에 연락하여 메리 친구들의 이메일 주소를 요청한다.

    5. 빅 소셜 네트워크는 요청을 수신하고 내부적으로 밥스북스가 해당 이메일 주소를 보유할 수 있는지 확인한 후 이를 전송한다.

## Putting it all together
- 제3자를 사용하여 사용자를 인증한 다음 해당 사용자의 개인 데이터에 액세스할 수 있는 권한을 부여하는 것은 인터넷에서 전자상거래의 성장을 촉진한 강력한 아키텍처 기법이다.

- 그림 4: 싱글 사인온 및 타사 인증은 엔터프라이즈급 전자상거래의 일반적인 기능입니다.

- 여러 도메인에 걸쳐 싱글 사인온을 사용하면 사용자 자격 증명 관리의 수고를 크게 줄일 수 있으므로 웹사이트와 서비스 제공업체는 핵심 비즈니스 역량에 집중하고 보안 관리와 같은 일상적이면서도 중요한 작업은 이러한 작업을 처리하는 데 더 적합한 ID 공급업체에 맡길 수 있다.

- 이 문서에서는 타사 인증을 사용하여 통합 인증을 구현하는 데 필요한 기본 개념에 대해 설명했다. 또한 싱글 사인온을 확장하여 사용자를 대신하여 인증을 구현하는 방법도 다루었다. 물론 악마는 항상 세부 사항에 있다. SAML, OAuth, OpenID와 같은 싱글 사인온 프로토콜에는 각각 특정한 작동 방식이 있다.