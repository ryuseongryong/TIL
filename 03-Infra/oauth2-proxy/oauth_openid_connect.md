- https://levelup.gitconnected.com/oauth-vs-openid-connect-8c567a017b46

# Oauth vs OpenID Connect
특히 소프트웨어 개발자에게는 OAuth2와 OpenID Connect의 구분이 혼란스러울 수 있습니다. 이 글에서는 실제 사례를 통해 이 두 인증 프로토콜의 차이점을 명확히 설명하고자 합니다.

## 간단한 데모 애플리케이션
간단한 시나리오부터 시작하겠습니다. 사용자가 좋아하는 레시피를 검색하고 공유할 수 있는 인기 있는 레시피 공유 앱을 만드는 소프트웨어 개발자가 있다고 가정해 보겠습니다. 첫 번째 과제는 사용자 ID를 관리하는 것입니다. 사용하는 ID 프로토콜에 관계없이 사용자의 정보를 ID 및 액세스 관리 시스템 내에 저장하기로 결정합니다. 사용자는 다음 이미지와 같이 이름과 이메일 등의 개인 정보를 제공하여 등록해야 합니다.

이 시나리오에서 사용자는 웹 브라우저를 사용하여 레시피 공유 앱과 상호 작용하고 레시피 데이터는 레시피 데이터베이스에 저장됩니다. 인증은 ID 및 액세스 관리 시스템을 통해 이루어집니다.

기본 인증방법
```
        인증 관리
           |
          인증
           |
유저 정보 -> 앱 <-> DB
```

## Oauth2
이제 사용자가 좋아하는 레시피를 Pinterest, Facebook 또는 Twitter와 같은 소셜 미디어 플랫폼에서 공유하고자 한다고 가정해 보겠습니다. 각각의 경우에 레시피 공유 앱은 사용자를 대신하여 이러한 외부 시스템과 통합해야 합니다. Pinterest와 Facebook은 모두 아래 그림과 같이 OAuth 프로토콜을 지원하며 자체 인증 서버 및 ID 저장소를 가지고 있습니다.

레시피 공유 앱의 관점에서 보면 Pinterest API를 호출하기 위해서는 Pinterest 인증 서버의 액세스 토큰과 Facebook의 API에 액세스하기 위한 유사한 토큰만 필요합니다. 앱은 이미 사용자 세부 정보를 보유하고 있으므로 오픈ID, 프로필 또는 이메일과 같은 범위를 요청할 필요가 없습니다. 이 상황은 OpenID Connect가 아닌 OAuth2의 주요 사용 사례입니다.

요점: 사용자(OAuth 용어로는 리소스 소유자)가 이 권한을 인증하고 승인해야 하지만, 레시피 공유 앱이 아닌 Pinterest 또는 Facebook의 ID 스토어를 통해 인증한다는 점에 유의하세요. 이는 앱으로 인증하는 것과는 다릅니다.

## OpenID 연결
더 많은 사용자를 유치하기 위해 Google 또는 Apple 계정이 있는 사용자가 명시적인 등록 없이도 레시피 공유 앱에 로그인할 수 있도록 하는 또 다른 사용 사례가 있다고 가정해 보겠습니다. 즉, 이러한 거대 기업의 ID 저장소를 활용하여 로그인할 수 있습니다. 이제 앱에는 ID 및 액세스 관리 시스템에 등록된 사용자, Google로 로그인하는 사용자, Apple로 로그인하는 사용자의 세 가지 유형이 있습니다. 다음 그림은 이 시나리오를 보여줍니다.

이제 레시피 공유 앱에서 세 가지 옵션이 있는 로그인 화면을 제공합니다:

자체 ID 및 액세스 관리를 통한 인증을 위한 사용자/비밀번호 필드.
Google 인증을 위한 링크입니다.
Apple 인증을 위한 링크입니다.
Google 또는 Apple 링크를 클릭하면 OpenID Connect 인증 엔드포인트 요청이 시작되어 사용자를 인증하고 정보를 검색합니다. 앱은 Google 또는 Apple 인증 서버에 대한 OAuth2 인증 요청에 openid, 프로필 및 이메일 범위를 포함합니다. 이 경우 앱은 Google 또는 Apple API에 대한 액세스를 요청하지 않으므로 리소스 범위가 생략됩니다. 권한 부여 서버는 사용자를 인증하여 ID 토큰, JWT(JSON 웹 토큰)가 포함된 JSON 응답을 제공합니다.

OpenID Connect를 사용할 때 레시피 공유 앱은 사용자 정보가 포함되어 있기 때문에 ID 토큰에 관심을 갖습니다. 그렇기 때문에 "openid" 범위를 사용합니다. 또한 앱은 인증 서버의 사용자정보 엔드포인트에 액세스하여 추가 사용자 세부 정보를 확인할 수 있습니다.

요점: OAuth와 OpenID Connect 모두 인증을 포함하지만 그 이유는 다릅니다. OpenID Connect 인증은 앱에 로그인하기 위한 인증인 반면, OAuth의 목적은 API 호출을 위한 액세스 토큰을 얻기 위한 것입니다.

## OAuth2 및 OpenID 연결

특히 엔터프라이즈 애플리케이션에서는 OAuth2와 OpenID Connect를 모두 사용하는 것이 일반적입니다. 이러한 경우 애플리케이션의 UI 구성 요소는 로그인(싱글 사인온 사용 가능)을 위해 OpenID Connect를 활용하고 마이크로서비스에 액세스하기 위해 애플리케이션별 범위를 활용할 수 있습니다. 엔터프라이즈 애플리케이션이 권한 부여 서버에 권한 부여 요청을 보낼 때 "openid" 범위와 애플리케이션별 범위가 모두 포함됩니다. 엔터프라이즈에서 액세스 토큰에는 역할 기반 인증을 위한 그룹 정보도 포함될 수 있습니다.

## 결론
이 데모에서는 레시피 공유 앱의 맥락에서 OAuth 2와 OpenID Connect를 사용한 인증 및 신원 관리의 세계를 살펴봤습니다. 두 가지 시나리오를 살펴봄으로써 이러한 인증 프로토콜의 뚜렷한 목적과 사용 사례를 조명해 보았습니다. 결론부터 말씀드리자면, OAuth는 리소스 API에 액세스하기 위해 인증 서버에서 액세스 토큰을 얻는 데 사용되며 OpenID Connect는 사용자 인증을 위한 ID 프로토콜로 사용됩니다. 두 프로토콜은 유사하지만 사용 의도는 서로 다릅니다.
