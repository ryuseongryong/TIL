- https://codersociety.com/blog/articles/jaeger-vs-zipkin-vs-tempo

# Open-Source Tracing Tools: Jaeger Vs. Zipkin Vs. Grafana Tempo
분산 추적은 복잡한 시스템을 모니터링하는 데 매우 중요합니다. 이 글에서는 가장 인기 있는 오픈 소스 추적 도구 세 가지를 다룹니다: 예거, 집킨, 그라파나 템포입니다.

아마존, 넷플릭스, 마이크로소프트, 구글과 같은 인터넷 규모의 기업이 등장하면서 분산 시스템과 마이크로서비스 애플리케이션의 새로운 시대가 열렸습니다.

분산 아키텍처를 사용하면 소규모의 독립적인 서비스 모음으로 구성된 복원력이 뛰어난 애플리케이션을 구축하고 운영할 수 있습니다. 하지만 본질적으로 복잡합니다. 이러한 복잡성은 시스템을 디버깅하거나, 병목 현상을 감지하거나, 장애를 추적하거나, 단순히 시스템에서 무슨 일이 일어나고 있는지 이해하려고 할 때 큰 골칫거리가 될 수 있습니다.

분산 아키텍처에서 사용자 요청은 서로 다른 프로그래밍 언어로 구현된 수십 개의 서비스를 통해 전달됩니다. 서로 다른 프로세스에 디버거를 연결하여 단계별로 문제를 해결하는 것은 사실상 불가능합니다. 이 때문에 모놀리식 시스템을 디버깅하는 기존의 방식은 분산 시스템에서는 비효율적인 것으로 입증되었습니다. 분산 추적은 이러한 문제를 해결하는 것을 목표로 합니다.

## 추적 기본 사항
분산 추적은 개발팀이 분산된 서비스, 애플리케이션, 데이터베이스를 가로지르는 요청을 추적할 수 있는 최신 진단 기법입니다. 이를 통해 소프트웨어 팀은 분산 애플리케이션을 프로파일링, 모니터링, 문제 해결 및 최적화할 수 있습니다.

추적은 애플리케이션의 진입 지점에서 사용자 요청으로 시작됩니다. 요청이 시스템을 통과하면서 시스템 구성 요소에서 요청에 대해 수행한 모든 처리 작업을 추적하는 추적을 생성합니다.

각 추적은 고유 ID를 가지며 스팬을 통과합니다. 이 스팬은 사용자 요청을 처리하기 위해 호출된 활동 또는 개별 작업 단위를 나타냅니다. 스팬에는 분석 및 디버깅에 유용한 고유 ID, 이름, 메타데이터, 타임스탬프 등의 정보가 포함됩니다.

소프트웨어 팀은 요청의 흐름을 처음부터 끝까지 추적함으로써 정상적인 추적과 비정상적인 추적을 비교할 수 있습니다. 타이밍, 구조, 동작의 차이를 확인함으로써 팀은 오버헤드를 줄이고 시스템 문제를 더 빠르게 해결하고 해결할 수 있습니다.

시중에 분산 추적 도구가 너무 많기 때문에 어떤 도구를 채택할지 결정하기 어려울 수 있습니다. 이 글의 나머지 부분에서는 Zipkin, 예거, 그라파나 템포의 기능 및 부족한 부분을 다룹니다.

## OpenTelemetry

애플리케이션 계측에는 두 가지 옵션이 있습니다. 필요에 맞는 맞춤형 추적 솔루션을 구축하거나 기존 추적 프레임워크 및 도구를 활용할 수 있습니다. 일반적으로 기존 도구는 맞춤형 도구보다 훨씬 더 많은 이점을 제공합니다. 또한, 팀에서 자체적으로 맞춤형 텔레메트리 수집기를 구현하는 데 필요한 시간과 리소스가 부족할 수도 있습니다.

바로 이 지점에서 커뮤니티가 주도하는 통합 가시성 프레임워크인 OpenTelemetry가 등장합니다. OpenTelemetry의 목표는 코드를 계측하는 데 사용할 수 있는 범용 API, 라이브러리, 에이전트 및 수집기 세트를 제공하는 것입니다.

OpenTelemetry는 최근 OpenTracing과 OpenCensus의 합병으로 탄생한 결과물입니다. 따라서 OpenTracing 또는 OpenCensus로 계측된 애플리케이션을 여전히 흔히 볼 수 있습니다. 두 가지 모두 간략하게 살펴보겠습니다.

### OpenTracing
OpenTracing은 개발자가 특정 공급업체나 제품에 종속되지 않는 API를 사용하여 코드베이스를 계측할 수 있도록 지원하는 CNCF(클라우드 네이티브 컴퓨팅 재단) 프로젝트이자 오픈 소스 프레임워크입니다. 오픈 소스 패키지 및 애플리케이션을 위한 분산 추적 표준을 제공합니다. 또한 여러 프로그래밍 언어에 대한 라이브러리 세트도 제공합니다. 이를 통해 분산 추적을 수집하고 UI에서 추적을 시각화하거나 다양한 백엔드로 데이터를 전송할 수 있습니다.

OpenTracing은 상용(예: Datadog 또는 Instana) 및 오픈 소스(예: Zipkin, Jaeger) 추적 솔루션과 통합됩니다.

### OpenCensus
OpenCensus는 분산 아키텍처를 채택하는 조직이 분산 추적을 위해 소프트웨어를 계측할 수 있도록 Google이 지원하는 오픈 소스 프레임워크입니다. OpenCensus는 OpenTracing과 마찬가지로 공급업체에 구애받지 않습니다. 개발자가 분산 추적 및 시계열 메트릭을 실시간으로 수집, 조작, 원하는 백엔드로 내보낼 수 있는 계측 및 API를 제공합니다.

OpenCensus는 사용자 정의 내보내기, 로컬 디버깅, gRPC 브리지를 제공합니다. 또한, 널리 사용되는 프레임워크, 라이브러리, MongoDB 및 Redis와 같은 제품과의 통합도 제공합니다. 이 프레임워크는 고도로 분산된 마이크로서비스, 대규모 모놀리식 또는 클라이언트 애플리케이션을 포함한 모든 소프트웨어 시스템과도 잘 작동합니다.

OpenTracing과 OpenCensus는 분산 추적을 구현하기 위한 API를 제공합니다. 프레임워크를 도입한 후에도 추적 데이터를 처리하고 애플리케이션의 성능을 모니터링하려면 분산 추적 도구가 필요합니다.

물론 각 도구의 장단점을 이해하지 못하면 어떤 도구를 사용해야 할지 알 수 없습니다. 다음 섹션에서는 두 가지 주요 분산 추적 도구인 Zipkin과 예거에 대해 살펴보고 Grafana Tempo를 소개합니다.

## The Battle of the Open-Source Tracing Tools

추적 데이터는 그 자체로는 로그 파일이나 원시 시계열 메트릭과 마찬가지로 분석에 불과합니다. 따라서 추적 데이터를 수집하는 것만으로는 데이터의 이점을 최대한 활용할 수 없습니다. 분산 시스템의 전반적인 동작을 이해하려면 추적 도구가 필요합니다. 애플리케이션에 장애가 발생하거나 응답이 없는 경우 Zipkin, Jaeger, Grafana Tempo와 같은 추적 도구를 사용하면 문제의 근본 원인을 추적하고 상호 연결된 수많은 서비스 중에서 문제가 있는 서비스를 식별할 수 있습니다.

### 1. Jaeger
예거는 마이크로서비스 기반 시스템의 모니터링 및 문제 해결을 위해 CNCF에서 인큐베이팅한 분산 추적 도구입니다. Jaeger는 OpenZipkin과 Dapper에서 영감을 받아 Uber Engineering에서 오픈 소스로 만들었습니다. 성능 및 지연 시간 최적화, 분산 트랜잭션 모니터링, 서비스 종속성 분석, 근본 원인 분석에 유용하게 사용할 수 있습니다.

Jaeger는 Golang으로 작성되었으며, Zipkin과 마찬가지로 공급업체에 구애받지 않습니다. 또한 확장 가능한 백엔드로서 ElasticSearch, Cassandra, Kafka를 지원합니다. 예거 추적은 다음과 같은 여러 기능을 제공합니다:
- 높은 확장성
- 키알리와의 통합
- 오픈트레이싱 호환성
- Zipkin과의 이전 버전 호환성
- 분산 컨텍스트 전파
- 적응형 샘플링

### 2. Zipkin
Zipkin은 Java 기반의 공급업체에 구애받지 않는 오픈소스 분산 추적 도구입니다. Google의 Dapper 백서를 기반으로 하는 Zipkin을 사용하면 소프트웨어 팀이 분산 아키텍처에서 추적 데이터를 전송, 수신, 저장 및 시각화할 수 있습니다.

Zipkin에는 애플리케이션을 통해 추적된 요청의 수를 보여주는 접근 가능한 UI와 종속성 다이어그램이 있습니다. 애플리케이션, 타임스탬프, 추적 길이를 기준으로 추적을 필터링하여 감가상각이 끝난 서비스 호출이나 오류 경로와 같은 총체적인 동작을 식별할 수 있습니다.

내부적으로 Zipkin은 추적 데이터를 저장하기 위한 백엔드로 ElasticSearch, Apache Cassandra, MySQL을 사용합니다. 또한 통신 프로토콜로 Kafka 또는 HTTP를 구현합니다. 하지만 RabbitMQ, gRPC, Apache ActiveMQ와 같은 다른 프로토콜도 있습니다.

### 3. Grafana Tempo
2020년에 Grafana Labs에서 출시한 Grafana Tempo는 대용량, 최소한의 종속성, 오픈 소스 도구입니다. Grafana Tempo의 개발자에 따르면, 이 도구는 Zipkin과 Jaeger를 대체할 수 있는 쉽고 비용 효율적이며 확장 가능한 대안이라고 합니다.

다른 추적 백엔드는 일반적으로 Cassandra나 ElasticSearch와 같은 데이터 저장소를 사용해야 합니다. 하지만 Grafana Tempo는 Google Cloud Storage나 Amazon S3와 같은 객체 스토리지만 있으면 작동합니다. 객체 스토리지를 사용하면 소프트웨어 팀이 샘플링할 필요 없이 분산된 애플리케이션에서 더 많은 양의 추적을 수집하고 저장할 수 있습니다.

그라파나 템포는 그라파나 로키, 프로메테우스, 그라파나와 통합됩니다. Loki에 대한 자세한 내용은 https://codersociety.com/blog/articles/loki-kubernetes-logging 에서 확인할 수 있습니다. 또한 Zipkin, Jaeger, OpenTelemetry 및 OpenCensus와도 호환됩니다. Grafana Tempo는 추적 검색을 위한 메트릭(예시) 및 로그와 함께 작동하도록 설계되었으며, traceID를 사용한 키/값 조회만 지원합니다.

## Jaeger, Zipkin, Grafana Tempo 비교
각 오픈소스 추적 도구에는 고유한 장단점이 있습니다. 어떤 도구를 사용할지는 다음과 같은 여러 가지 요인에 따라 결정됩니다:

- 오픈트레이싱 호환성
- 스토리지 지원
- 배포 옵션
- 언어 및 라이브러리 지원

https://cdn.codersociety.com/uploads/opentracing-comparison.png

### 어떤 추적 툴이 나에게 적합할까요?
Jaeger, Zipkin, Grafana Tempo는 모두 요청 또는 시스템 이벤트를 추적, 수집, 분석하여 애플리케이션에서 발생하는 상황을 파악할 수 있는 강력한 도구이지만, 특정 특성으로 인해 Grafana Tempo가 더 돋보입니다.

Grafana Tempo는 가격이 저렴하고 저렴한 비용으로 대량의 추적을 저장할 수 있습니다. 이 도구는 OpenTelemetry 및 Opentracing과 호환되며 Grafana Loki, Prometheus와 같은 다른 도구와 통합됩니다. 또한 예거와 집킨의 스팬을 받아들일 수 있습니다.

그라파나 템포는 아직 베타 단계로 커뮤니티 지원이 부족하지만, 사용이 간편하고 비용이 저렴하여 수집 및 저장하는 분산 추적의 수를 늘리려는 팀에게 적합합니다.

분산 추적 도구의 경쟁은 치열하지만 Grafana Tempo는 미래가 촉망되는 새롭고 현대적인 젊은 도구입니다. 앞으로 몇 년 안에 Grafana Tempo가 큰 차이로 승리한다고 해도 놀랍지 않을 것입니다.

