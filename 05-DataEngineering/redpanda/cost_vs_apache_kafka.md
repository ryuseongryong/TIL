- https://redpanda.com/blog/is-redpanda-better-than-kafka-tco-comparison

# Redpanda vs. Apache Kafka: A Total Cost of Ownership comparison

레드판다는 레거시 플랫폼에서 실행되는 동일한 워크로드에 대해 카프카보다 6배 더 비용 효율적이면서 하드웨어 사용 공간을 줄일 수 있습니다.

### Redpanda는 아파치 카프카보다 최대 6배 더 비용 효율적이고 10배 더 빠릅니다.
이 글에서는 자체 호스팅 배포 모델에서 실제 데이터 스트리밍 사용 사례와 처리량을 위해 Apache Kafka®와 Redpanda 클러스터를 모두 실행하는 데 드는 전체 비용을 살펴봅니다. 비용 모델을 정의하고, 보안 및 재해 복구(DR)를 포함한 대표적인 구성을 사용해 두 시스템의 물리적 특성을 테스트한 다음, 두 시스템의 관리 비용을 평가할 것입니다.

## Defining a cost model for data streaming
지금과 같은 경제 환경에서는 모든 사람이 비용을 가장 중요하게 생각합니다. 새로운 소프트웨어 플랫폼 도입에 따른 투자 수익률(ROI)을 평가할 때는 총소유비용(TCO)을 우선적으로 고려해야 합니다. TCO는 모든 인프라, 인력, 교육 및 구독 비용을 포함하여 예상 수명 기간 동안 소프트웨어를 배포, 구성, 보안, 프로덕션 및 운영하는 데 드는 총비용을 의미합니다.

이 비교를 위해 TCO를 다음 구성 요소의 조합으로 정의합니다:

1. 인프라: 컴퓨팅 및 스토리지 비용(이 경우 AWS).

2. 관리: 클러스터의 배포, 설치 및 유지 관리 비용입니다.

인프라 비용 비교를 위해 벤치마크를 실행하여 레드판다와 카프카의 성능을 비교했습니다. 대체로 유사한 성능 특성을 가진 인프라 프로필을 설정하여 두 플랫폼 간의 비용 차이를 계산할 수 있었습니다.

## Comparing infrastructure costs

### Sizing for throughput at a given latency
소규모, 중규모, 대규모 워크로드에 대해 200시간이 넘는 테스트를 실행하여 Apache Kafka 및 Redpanda의 성능 프로필을 생성했습니다.

성능 테스트를 실행할 때는 예측 가능한 낮은 엔드투엔드 지연 시간을 찾고 있었습니다. 지연 시간이 비교적 안정적으로 유지되도록 노드 수를 조정했습니다(즉, 높은 처리량에서도 시스템에 과부하가 걸리지 않도록).

성능 벤치마크 보고서의 결과는 다음과 같습니다:

1. Redpanda의 평균 및 P99+ 엔드투엔드 지연 시간 프로필은 높은 처리량에서도 놀라울 정도로 일관되게 유지됩니다.

2. Kafka는 노드 3개로는 초당 500MB 이상의 워크로드(총 처리량 1GB/초)를 처리할 수 없었습니다. 필요한 생산 속도로 테스트를 완료할 수 없었습니다.

3. 지연 시간 프로필을 균일하게 유지하기 위해 더 큰 Kafka 클러스터를 반복적으로 생성해야 했으며, 그럼에도 불구하고 P99.9 지연 시간은 Redpanda의 3배 클러스터 크기에서 200ms를 초과했습니다.

4. 소규모 워크로드의 경우, Redpanda는 저렴한 AWS Graviton(ARM) CPU에서 약간 더 빠르게 실행할 수 있었던 반면, Kafka는 이러한 인스턴스 유형에서 어떤 수준의 성능으로도 작동할 수 없었습니다.

비용 모델을 구축하기 위해서는 비슷한 성능 특성을 달성하기 위해 Redpanda와 Kafka 클러스터의 규모를 조정해야 했으며, 그 목표는 P99.9ms 지연 시간을 20ms 미만으로 줄이는 것이었습니다. 성능 테스트 결과 다음과 같은 규모 조정이 필요했습니다(경우에 따라 지연 시간을 20배 이내로 줄이기 위해 Kafka의 노드 수를 Redpanda의 최대 3배까지 확장해야 했지만).

- https://images.ctfassets.net/paqvtpyf8rwu/6S5chmR8oJ5mBVwwYqU7fk/82a761819fa19a469d4bb14d92e582b0/workload.png
(목표 지연 시간 프로필에서 소규모, 중간 규모, 대규모 워크로드 전반의 인프라 요구 사항을 비교합니다.)

Redpanda 실행의 주요 이점 중 하나는 배포가 간단하다는 것입니다. Redpanda는 외부 종속성이 없는 단일 바이너리로 배포되기 때문에 ZooKeeper나 스키마 레지스트리를 위한 인프라가 필요하지 않습니다. 또한, 자동 파티션 및 리더 밸런싱 기능이 포함되어 있어 크루즈 컨트롤을 실행할 필요가 없습니다.

아래 비용 모델에서는 Redpanda를 실행하는 데 드는 인프라 비용을 다음과 같이 보여줍니다:

- 소규모 워크로드: 50MB/초
- 중간 및 대규모 워크로드: 초당 500MB 및 초당 1GB

여기에는 워크로드 자체를 실행하는 데 필요한 브로커 수와 Kafka의 경우 크루즈 컨트롤, 스키마 레지스트리(고가용성을 위한 두 개의 노드), ZooKeeper(세 개의 노드)를 실행하는 인스턴스 수가 포함됩니다.

참고: Apache Kafka는 3.3 릴리즈에서 ZooKeeper를 대체하는 KRaft에 대한 지원을 추가했지만, 아직 기능이 완벽하지는 않습니다. 이 기능이 널리 채택되기까지는 다소 시간이 걸릴 것으로 예상되며, 비용 모델에 KRaft를 반영하지 않았습니다.

## Small workload: 50 MB/sec

소규모 워크로드의 경우, i3en.xlarge 인스턴스에서 실행되는 Redpanda와 Kafka의 성능 프로필이 비슷한 반면, 더 작은 i3en.large 인스턴스에서는 Redpanda가 Kafka에 비해 성능 향상을 보여줄 수 있다는 것을 확인했습니다.

하지만 워크로드가 충분히 크지 않아서 i3en.large 머신을 완전히 사용할 수 없었다는 점에 주목했습니다. AWS Graviton(ARM 기반) 인스턴스를 도입함으로써 훨씬 저렴한 비용으로 Redpanda의 성능을 개선할 수 있었습니다. Kafka와 Redpanda 성능 비교 블로그에서 자세히 설명했듯이, Kafka는 Graviton 인스턴스에서 실행할 수 없었습니다.

이 표의 비용 비교는 i3en.xlarge에서 실행되는 Kafka와 is4gen.medium 인스턴스에서 실행되는 Redpanda를 비교한 것입니다.

- https://images.ctfassets.net/paqvtpyf8rwu/3J4lP4tK2As1NMi88v6uuT/4e15896f8508f5c24646c65a9f8943b7/50mb_instance_size.png
(카프카와 레드판다의 초당 50MB 워크로드에 대한 인프라 비용 비교.)

AWS Graviton 인스턴스에서 Redpanda를 실행하는 것과 비교했을 때, Kafka는 3~4배 더 비쌉니다. Kafka를 위한 i3en.large 인스턴스의 성능은 동일한 하드웨어 또는 Graviton에서 i3en.xlarge의 Kafka나 Redpanda보다 좋지 않았습니다. 이 워크로드에 Redpanda를 사용하면 연간 최대 $12,969의 비용을 절감할 수 있습니다.