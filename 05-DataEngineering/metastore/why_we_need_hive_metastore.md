# Why we need hive metastore
- https://blog.jetbrains.com/big-data-tools/2022/07/01/why-we-need-hive-metastore/

- 데이터 엔지니어링 세계에서 데이터는 단순한 데이터가 아니라 우리 업무의 생명선이다. 대부분의 경우 데이터는 우리가 작업하는 모든 것이다. 우리 코드는 데이터 중심적이며, 현존하는 유일한 5세대 언어인 SQL을 사용한다. (5세대 언어는 달성하고자 하는 목표를 정의하면 언어 자체가 문제를 해결해 주는 언어이다.)
- 하지만 여기에는 큰 "하지만"이 있다. 데이터는 멋지고, 데이터로 작업하는 것은 흥미롭지만, 데이터에 액세스하는 것은 종종 번거롭다. 데이터는 다양한 형식, 다양한 위치, 다양한 액세스 제한 하에 여러 가지 형태로 저장되며 매우 다양한 방식으로 구조화되어 있다. 우리는 이 모든 것을 알고 있어야 하고, 모든 것을 쿼리해야 하며, 때로는 쿼리에 모든 데이터를 결합해야 하기도 한다.
- 따라서 데이터 저장소에 대한 모든 정보를 관리할 수 있는 하나의 장소가 필요하다. 바로 이 곳이 Hive 메타스토어이다.

## Hive Metastore
- Amazon 웹사이트에 따르면 Hive Metastore는 "대규모 분석을 가능하게 하는 분산형, 내결함성 데이터 웨어하우스 시스템"인 Apache Hive의 일부로 개발되었다. 즉, 기본적으로 한 곳에서 모든 것을 쿼리할 수 있다.

- Hive는 데이터 저장소에 대한 모든 메타 정보를 저장하는 지점이 되어 이 목표를 달성한다. 일반 SQL에 비해 몇 가지 제한 사항이 있지만 몇 가지 장점도 있는 HSQL 방언을 사용하는 Hive를 사용하면 모든 데이터 구조를 SQL로 쿼리하기에 적합한 구조로 투영할 수 있다.

- Hive 메타스토어의 한 가지 약간 헷갈리는 점은 이름에 "Hive"가 들어가 있지만 실제로는 Hive와는 별개이며 완전히 독립적이라는 점이다.

- 이제 구성 요소에 대해 이야기하고 있으므로 Hive Metastore의 아키텍처를 살펴보자.

## Architecture
- 데이터가 SQL로 투영되기 때문에 데이터에 대한 정보는 거의 엔티티-속성-값과 같은 간단한 관계형 구조로 매우 쉽게 매핑할 수 있다. 예를 들어, 엔티티 '테이블' - 속성 '이름' - 값 '클릭스트림'.

- Hive 메타스토어는 기본 저장소에서 지원되는 HSQL 유형으로 유형을 투영하고 기본 데이터의 위치에 대한 정보를 저장한다. 이 데이터는 메타스토어 데이터베이스에 저장되며, 일반적으로 MySQL, Postgres 또는 Derby이다.

- 그러나 데이터베이스 자체는 구현 세부 사항일 뿐이다. 스키마는 다소 유동적이며 시간이 지남에 따라 사전 통지 없이 변경된다. (hive-dev 메일링 리스트를 팔로우하면 변경 사항을 추적할 수 있지만, 그렇게 하는 사람은 거의 없다). 이 데이터베이스의 용도는 단 하나, 중고품 서버에 데이터를 제공하는 것이다.

- 메타스토어 중고품 서버는 메타스토어 클라이언트의 주요 진입점이다. 잠시 Thrift에 대해 집중해 보자. Thrift는 처음에 Facebook에서 만들었고 현재는 Apache Software Foundation에서 유지 관리하는 RPC 프로토콜이다. 저는 여러 가지 이유로 매우 인기 있는 gRPC 대신 Thrift를 선택했다
    1. 예외를 입력했다. 따라서 RPC 내부에서 무작위로 예외가 발생하는 것이 아니라 실제로 무엇이 잘못되었는지 이해할 수 있다.
    2. 풍부한 표준 라이브러리가 있다(사전 정의된 유형 집합을 그렇게 부를 수 있다면).
    3. gRPC와 마찬가지로 많은 언어를 지원하지만, 제 생각에는 Thrift의 생성기가 gRPC의 생성기보다 훨씬 더 멋진 코드를 생성한다.
- 이 중고품 프로토콜은 Facebook에서 빅데이터 생태계의 요구를 충족하기 위해 개발되었지만, 제 생각에는 Hive는 물론 다른 생태계에도 완벽하게 적합하다.

- 다시 중고품 서버로 돌아가서, 이 서버는 Hive Metastore가 인식하고 있는 데이터 소스에 대한 필요한 정보를 얻을 수 있는 API를 갖춘 매우 간단한 애플리케이션이다. 이 애플리케이션은 타이핑 방식이지만, Thrift의 코드 생성기가 지원하는 Python과 같은 동적 타이핑 언어에서도 사용할 수 있다.

- 그리고 아키텍처의 다음 부분은... 더 이상 부품이 없다는 것이다! Hive 자체를 포함한 모든 클라이언트는 Hive 메타스토어 중고품 서버와만 통신한다. Thrift 서버는 매우 간단해서 Thrift 서버를 위한 단일 도커 컨테이너로 스핀업할 수 있다(더비를 메타스토어 데이터베이스로 사용한다고 가정할 때). 물론 프로덕션 환경에서는 드문 설정이지만 실험용으로 매우 유용하다.

