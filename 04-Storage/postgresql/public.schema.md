# New Public Schema Permissions in PostgreSQL 15
- https://www.enterprisedb.com/blog/new-public-schema-permissions-postgresql-15

- PostgreSQL 15의 변경 사항 중 하나는 public 스키마에 대한 새로운 기본 권한집합이다.
- 각 데이터베이스에는 기본적으로 public 스키마가 포함되어 있다. 이 스키마는 기본적으로 search_path의 일부이다.
  따라서 명령에 스키마를 지정하지 않으면 모든 활동이 이 public 스키마에서 수행된다. 스키마에 신경 쓰지 않는다면 이 기능을 사용하면 스키마가 PostgreSQL에 추가되기 전(v7.3)처럼 테이블이 데이터베이스 내부에 직접 있는 것처럼 데이터베이스를 사용할 수 있따. 사실 이 전체 설정은 스키마 이전에서 스키마로 원활하게 전환하기 위해 세심하게 조정된 것이다.
- 이 설정의 일부로 public 스키마에는 기본 권한 세트도 있다. 이 스키마에는 누구나 스키마의 개체를 참조할 수 있는 Usage권한(동일한 이름의 스키마와 관련이 없는 모든 사람을 의미함)이 부여되어 있다. 그리고 누구나 스키마에 있는 개체를 만들 수 있는 CREATE 권한이 부여되어 있다. 문제는 CREATE 권한이다. 누구나 스키마에 개체를 생성할 수 있다면 다른 사용자가 시스템 카탈로그(pg_catalog 스키마)에 있는 개체 대신 자신의 개체를 사용하도록 속일 수 있다.
- 기본적으로 CREATE 권한을 부여하지 않을 수 있다. 그런 다음 데이터베이스 소유자가 원하는 경우 직접 명시적으로 CREATE 권한을 부여할 수 있다. 이렇게 하면 보안을 좀 더 강화할 수 있다. 
  그러나 PostgreSQL 14(또는 이전 버전)설치를 자세히 살펴보면 public 스키마는 실제로 데이터베이스 부트스트랩 사용자(일반적으로 postgres)가 소유하고 있다. 
  그러나 데이터베이스는 각각 부트스트랩 사용자나 수퍼유저가 아닌 다른 소유자를 가질 수 있다.
  이는 PostgreSQL에서 데이터베이스를 만들 때 실제로 템플릿 데이터베이스를 복사하기 때문이고, 그 시점에서는 데이터베이스 소유자가 누구인지 알 수 없다.
  따라서 수퍼유저가 아닌 데이터베이스 소유자는 새로 생성된 데이터베이스를 보고 다른 사용자가 소유한 public 스키마를 발견할 수 있고, 해당 스키마에 대해 GRANT문을 수행할 수 없다.
- 이 문제를 해결하려면 변경할 것이 있다.
  1. 현재 데이터베이스의 실제 소유자를 멤버로 암시적으로 포함하는 새로운 역할 pg_database_owner가 있다. 
  2. 이제 public 스키마는 해당 역할이 소유한다.
  3. public 스키마에는 더 이상 기본적으로 CREATE 권한이 부여되지 않는다.
- 따라서 이제 기본적으로 권한이 없는 사용자는 더 이상 공개 스키마에 함정을 설치할 수 없다. 하지만 데이터베이스 소유자는 이제 이러한 권한을 적절하게 조정할 수 있는 권한을 갖게 된다.
- 이전 버전에서 PostgreSQL 15로 업그레이드하면 원래 권한이 유지되므로 설정이 자동으로 적용되지 않는다. 업그레이드된 데이터베이스를 수정하는 명령어 : `ALTER SCHEMA public OWNER TO pg_database_owner;
REVOKE CREATE ON SCHEMA public FROM PUBLIC;`