# HammerDB
## TPC description
- TPC는 벤치마크를 정의하는 데 가장 널리 인정받는 업계 단체
- TPC 사양은 데이터베이스 업계에서 모든 주요 DB 공급업체가 인정하는 유일한 공개 벤치마크임.
- TPC-C는 OLTP를 위해 TPC에서 발표한 벤치마크.
    - TPC 정책은 TPC 공정 사용 규칙을 준수하는 TPC 벤치마크 표준의 도출을 허용함.
- TPROC-C는 지원되는 모든 데이터베이스 환경에서 HammerDB를 간단하고 비용 효율적으로 실행할 수 있도록 수정된 TPC-C 사양에서 파생된 HammerDB에서 구현된 OLTP워크로드.
    - 전체 TPC-C 벤치마크 표준이 아닌 하위 집단을 준수하기 때문에 공개된 TPC-C 결과와 비교할 수 없음.
    - TPROC-C는 TPC-C 사양에서 파생된 트랜잭션처리 벤치마크를 의미함.

## TPROC-C workload
- HammerDB TPROC-C 워크로드는 의도적으로 완전히 최적화되지 않았으며 특정 데이터베이스 구현이나 시스템 하드웨어에 편향되지 않은 오픈 소스이므로 모든 HammerDB 소스 코드를 자유롭게 검사하고 풀 리퀘스트를 제출하여 워크로드를 업데이트 또는 개선할 수 있음 
- 그 목적은 데이터베이스를 테스트할 때 복잡한 구성이나 테스트 중인 데이터베이스 외에 추가적인 타사 소프트웨어 없이도 바로 사용할 수 있는 환경을 제공하기 위함
- HammerDB는 간단한 노트북 기반의 익스프레스형 데이터베이스 설치부터 8, 16, 32 CPU 소켓 서버 및 클러스터에 이르기까지 모든 환경에서 실행할 수 있음. 
- 중요한 요소는 HammerDB 워크로드는 정확하고 반복 가능하며 일관된 결과를 생성하도록 안정적이고 확장 가능하며 테스트되도록 설계되었다는 점. 
    - HammerDB는 시스템 간의 절대적인 데이터베이스 성능이 아닌 상대적인 성능을 측정하도록 설계. 
    - 특정 하드웨어 및 소프트웨어 구성에 대해 테스트를 실행하고 정확히 동일한 구성에 대해 동일한 테스트를 다시 실행하면 일반적으로 1% 이내의 트랜잭션 무작위 선택 범위 내에서 정확히 동일한 결과를 얻을 수 있다는 의미. 
    - 결과 간의 차이는 구성 변경(또는 데이터베이스 체크포인트 또는 사용자/관리자 오류와 같은 시스템 관리 오버헤드)의 직접적인 결과. 
    - 테스트 결과, 신뢰할 수 있는 동일한 구성에서 무인(자동 파일럿 기능 참조)으로 HammerDB 테스트를 여러 번 다시 실행하면 서로 거의 동일하게 오버레이되는 성능 프로파일이 생성되는 것으로 입증됨. 
    - 즉, HammerDB는 매번 동일한 결과를 제공하므로 결과가 다를 경우 데이터베이스, OS 및 하드웨어 구성에 전적으로 집중해야 함.

## TPC-C vs TPROC-C
- HammerDB는 TPROC-C라는 TPC-C 사양을 기반으로 TPROC-C라는 워크로드를 구현하지만 전체 사양의 TPC-C 벤치마크를 구현하지 않으며, HammerDB의 트랜잭션 결과는 공식적으로 발표된 TPC-C 벤치마크와 어떤 방식으로도 비교할 수 없음.
- 공식 감사 TPC-C 벤치마크는 설정 및 유지에 많은 비용과 시간이 소요되며 복잡함.
- TPC-C 벤치마크 사양에 기반한 HammerDB 구현은 모든 데이터베이스 환경에 전문적이고 안정적이며 예측 가능한 부하 테스트를 제공하는 모든 시스템에서 저렴한 비용으로 실행할 수 있는 형태로 TPC-C의 본질을 포착하도록 설계. 
- 따라서 HammerDB 결과는 어떤 상황에서도 tpmC라는 용어와 비교하거나 사용해서는 안 됨. 
- HammerDB 워크로드는 각각 TPM과 NOPM이라는 시스템을 비교하기 위해 두 가지 통계를 생성함. 
- NOPM 값은 테스트 스키마 자체에서 캡처한 메트릭을 기반으로 함. 
    - 따라서 특정 데이터베이스 구현과 무관한 성능 지표로서 NOPM(분당 신규 주문 수)을 사용하는 것이 권장되는 기본 지표.
- TPROC-C에서 warehouse는 데이터 웨어하우징 워크로드와는 무관함.
- HammerDB는 워크로드를 더 간단하고 실행하기 쉽게 만들기 위해 의도적으로 수정된 전체 TPC-C 사양의 하위 집합으로 볼 수 있음.
- 주요 유사점은 스키마 정의와 데이터, 그리고 저장 프로시저로 구현된 5개의 트랜잭션이라는 것. 
- 주요 차이점은 기본적으로 HammerDB는 키 및 사고 시간을 활성화하지 않은 상태로 실행된다는 것
    - 이벤트 기반 확장을 활성화하면 많은 수의 사용자 세션에서 키 및 사고 시간을 실행할 수 있음.
    - 즉, HammerDB TPROC-C는 CPU 및 메모리 집약적인 버전의 TPC-C 워크로드를 실행하게 됨.
    - 이는 또한 최대 수준의 성능에 도달하기 위해 가상 사용자 수와 필요한 데이터 세트가 전체 TPC-C 구현보다 훨씬 작아진다는 것을 의미함
- HammerDB는 또한 전체 사양처럼 터미널을 구현하지 않음.
    - 그럼에도 불구하고 HammerDB TPROC-C 구현을 사용하면 관계형 데이터베이스 기능에 대한 강력한 테스트를 제공하면서 최대 수준의 성능에 도달하기 위해 많은 수의 클라이언트 시스템과 타사 미들웨어가 필요하지 않으며 매우 큰 데이터 세트가 필요하지 않음.
- 워크로드
    - 각 가상 사용자는 워크로드의 약 90%가 발생하는 홈 웨어하우스라는 개념을 가지고 있음.
    - HammerDB를 사용하면 이 홈 웨어하우스는 테스트 시작 시 무작위로 선택되며 고정된 상태로 유지. 
    - 예를 들어, 1000개의 웨어하우스로 스키마를 구성하고 기본적으로 10명의 가상 사용자로 테스트를 실행하면 대부분의 워크로드가 10개의 웨어하우스에 집중된다는 것을 이해할 수 있음. (원하는 경우 이 동작을 변경할 수 있는 예외가 있으므로 여기서 "기본적으로"라는 단서에 유의해야 함.) 
    - 또한 홈 창고를 무작위로 선택하는 경우, 실행할 최대 가상 사용자 수를 구성할 때 한 명 또는 두 명의 가상 사용자가 동일한 홈 창고를 무작위로 선택하되 그 이상은 선택하지 않도록 하여 사용 가능한 창고에 고르게 분산되도록 창고 수를 구성해야 함.

## TPC-H description
- 분석 워크로드는 의사 결정 지원, 데이터 웨어하우징 또는 비즈니스 인텔리전스로도 설명할 수 있으며, 이러한 워크로드의 기본은 대량의 데이터에 대한 복잡한 임시 쿼리를 처리할 수 있는 기능.
- 트랜잭션 워크로드와 달리 데이터 수정이 아닌 읽기에 중점을 두기 때문에 별도의 접근 방식이 필요. 
- 트랜잭션을 처리하는 데이터베이스의 능력은 쿼리 기반 워크로드를 지원하는 데이터베이스의 능력에 대한 제한적인 정보를 제공하며, 그 반대의 경우도 마찬가지이므로 특정 데이터베이스의 능력을 조사할 때 TPROC-C와 TPROC-H 기반 워크로드는 서로를 보완함. 
- 쿼리 워크로드를 충족하기 위해 대량의 데이터를 읽을 때 여러 CPU 코어를 사용할 수 있는 경우 단일 처리 스레드로 읽으면 상당한 양의 리소스가 제대로 활용되지 않을 수 있음. 
- 따라서 가장 효과적인 분석 시스템에서는 병렬 쿼리라는 기능을 사용하여 이러한 쿼리를 여러 개의 하위 작업으로 나누어 쿼리를 더 빨리 완료함. 
- 열(column) 방향, 압축 및 파티셔닝과 같은 추가 기능도 병렬 쿼리 성능을 개선하는 데 사용할 수 있음.
- 서버 기술, 특히 대용량 메모리 구성에 사용할 수 있는 많은 수의 CPU 코어가 발전함에 따라 병렬 쿼리 성능을 향상시키는 수단으로 인메모리 및 컬럼 저장소 기술이 대중화됨. 
- 이러한 향상된 쿼리 기술의 일부 또는 전부를 지원하는 HammerDB가 지원하는 데이터베이스의 예로는 Oracle 데이터베이스, SQL Server, Db2, MariaDB 및 PostgreSQL이 있으며, 이러한 기술을 지원하지 않는 데이터베이스는 단일 스레드 쿼리 워크로드이므로 이러한 워크로드를 빠르게 완료할 것으로 기대할 수 없음
- 상용 데이터베이스의 경우 단일 스레드 워크로드만 지원하는 데이터베이스 버전이 있을 수 있으므로 라이선스에 병렬 워크로드를 실행할 수 있는 기능이 포함되어 있는지 확인이 필요함.

## TPROC-H vs TPC-H
- OLTP 유형의 TPROC-C 워크로드를 보완하기 위해 HammerDB에는 의사 결정 지원 기반 TPC-H 벤치마크 표준의 공정 사용 파생도 포함
- HammerDB TPROC-H 워크로드는 TPC-H 벤치마크 표준에서 파생된 오픈소스 워크로드로서, TPC-H 벤치마크 표준을 준수하지 않기 때문에 공개된 TPC-H 결과와는 비교할 수 없음
- 간단히 말해서 TPROC-H는 도매 공급업체의 활동과 관련하여 TPROC-C에서 구현된 작업 부하를 보완하는 것으로 생각할 수 있음
- 그러나 TPROC-C가 온라인 주문 시스템을 시뮬레이션하는 반면, TPROC-H는 운영에 대한 분석 쿼리를 실행하는 소매업체의 일반적인 워크로드를 나타냄. 
    - 이를 위해 TPROC-H는 비즈니스에 초점을 맞춘 일련의 임시 쿼리(동시 데이터 업데이트 및 삭제 외에도)로 표현되며, 이러한 쿼리를 완료하는 데 걸리는 시간을 기준으로 측정됨.
    - 특히 대량의 데이터를 처리해야 하는 매우 복잡한 쿼리에 중점. 
- 또한 TPROC-C와 유사하게 스키마 크기는 고정되어 있지 않고 스케일 팩터에 따라 달라지므로, 스키마는 원하는 만큼 작거나 커질 수 있으며, 더 큰 스키마는 쿼리를 위해 더 강력한 컴퓨터 시스템이 필요하므로 더 많은 데이터 볼륨을 처리할 수 있음. 
- 그러나 TPROC-C와 달리 스키마 다이어그램에서 SF(Scale Factor)로 표시된 다른 스케일 팩터에서 수행한 쿼리 부하 테스트의 테스트 결과를 비교하는 것은 유효하지 않음.

### TPROC-H Geometric vs TPC-H QphH
- TPC-H 워크로드에 대한 감사 메트릭은 QphH라고 하지만, 이러한 워크로드가 실행되는 방식, 특히 데이터 로드를 위한 대량 작업을 사용하는 방식이 다르기 때문에 HammerDB 워크로드에 대해 QphH를 계산하지 않는 것이 좋음. 
- 대신 전력 및 처리량 테스트 쿼리 시간의 기하학적 평균을 측정하고 비교하는 것이 좋음.
- 감사 결과에는 쿼리를 처리하는 시스템 기능의 다음 3가지 측면이 고려됩니다:
    1. DB 크기
    2. 단일 스트림에서 쿼리의 쿼리 처리 성능
    3. 여러 동시 사용자의 쿼리에 대한 총 쿼리 처리량
- 다중 동시 사용자 테스트의 경우 처리량 테스트는 항상 성능 테스트를 따르며, 가상 사용자 수는 HammerDB에서 각 스트림이 가상 사용자에 의해 처리되는 다음 표를 기준으로 함.(https://www.hammerdb.com/docs/ch11s02.html) 이 표는 HammerDB에서 쿼리 집합을 완료하는 데 가장 느린 가상 사용자의 쿼리 시간의 기하평균을 메트릭으로 사용하여 처리량 테스트를 실행할 때 지침으로 사용할 수도 있음.
- 동시 데이터 새로 고침 세트도 사용할 수 있음. HammerDB는 이 새로 고침 세트를 성능 테스트의 일부로 자동으로 실행하거나 처리량 테스트와 동시에 실행할 수 있는 모든 기능을 제공. 그러나 새로 고침 세트가 실행되면 스키마를 새로 고쳐야 하므로 새로 고침 세트 실행이 계획된 경우 HammerDB TPROC-H 기반 스키마를 백업 및 복원하는 것이 좋음.

### Ref
- https://www.hammerdb.com/docs/