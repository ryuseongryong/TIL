- https://datatracker.ietf.org/doc/html/rfc7636

## 요약
- 인증 코드 부여를 활용하는 Oauth2.0 public clients는 인증 코드 가로채기 공격에 취약하다. 이 사양에서 공격과 코드 교환용 증명 키(PKCE)를 사용하여 위협을 완화하는 기술에 대해 설명한다.

## Introduction
- OAuth 2.0(RFC6749) 공용 클라이언트는 인증 코드 가로채기 공격에 취약하다.
- 이 공격에서 공격자는 통신 경로 내에서 인증 엔드포인트에서 반환된 인증코드를 가로챈다. 통신 경로 내의 인증 엔트포인트에서 반환된 인증코드를 가로챈다. 클라이언트 운영 체제 내의 애플리케이션 통신과 같이 전송 계층 보안에 의해 보호되자 않는 통신이다.
- 공격자가 인증 코드에 액세스하면 다음을 수행하여 액세스 토큰을 획득한다.
- OAuth 2.0[RFC6749] 퍼블릭 클라이언트는 인증 코드 가로채기 공격에 취약하다. 이 공격에서 공격자는 클라이언트 운영 체제 내 애플리케이션 간 통신 등 TLS로 보호되지 않는 통신 경로 내에서 인증 엔드포인트에서 반환된 인증코드를 가로챈다. 공격자가 인증 코드에 액세스하면 이를 사용하여 액세스 토큰을 얻을 수 있다.
- 그림 1은 공격을 나타낸다. 
  1단계에서는 스마트폰처럼 유저가 사용하는 디바이스에서 실행되는 기본 애플리케이션이 브라우저/운영 체제를 통해 OAuth 2.0인증 요청을 발행한다. 이 경우 리디렉션 엔드포인트 URI는 일반적으로 사용자 지정 URI 체계를 사용한다. 1단계는 가로챌 수 없는 보안 API를 통해 발생하지만 고급 공격 시나리오에서는 잠재적으로 관팔될 수 있다. 
  그런 다음 요청은 2단계에서 OAuth 2.0인증 서버로 전달된다.
  OAuth에서는 TLS를 사용해야 하므로 이 통신은 TLS로 보호되며 가로채기가 불가능하다. 인증 서버는 3단계에서 인증 코드를 반환한다. 4단계에서는 1단계에서 제공된 리디렉션 엔드포인드 URI를 통해 인증 코드가 요청자에게 반환된다.
- 악성 앱이 합법적인 OAuth 2.0 앱 외에도 사용자 지정 구성표에 대한 처리기로 자신을 등록할 수 있다는 점에 유의해야한다. 일단 그렇게 하면 악성 앱은 이제 4단계에서 인증 코드를 가로챌 수 있다. 이를 통해 공격자는 각각 단계 5와 6에서 액세스 토큰을 요청하고 얻을 수 있다.

- ```
    +~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+
    | End Device (e.g., Smartphone)  |
    |                                |
    | +-------------+   +----------+ | (6) Access Token  +----------+
    | |Legitimate   |   | Malicious|<--------------------|          |
    | |OAuth 2.0 App|   | App      |-------------------->|          |
    | +-------------+   +----------+ | (5) Authorization |          |
    |        |    ^          ^       |        Grant      |          |
    |        |     \         |       |                   |          |
    |        |      \   (4)  |       |                   |          |
    |    (1) |       \  Authz|       |                   |          |
    |   Authz|        \ Code |       |                   |  Authz   |
    | Request|         \     |       |                   |  Server  |
    |        |          \    |       |                   |          |
    |        |           \   |       |                   |          |
    |        v            \  |       |                   |          |
    | +----------------------------+ |                   |          |
    | |                            | | (3) Authz Code    |          |
    | |     Operating System/      |<--------------------|          |
    | |         Browser            |-------------------->|          |
    | |                            | | (2) Authz Request |          |
    | +----------------------------+ |                   +----------+
    +~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+

             Figure 1: Authorization Code Interception Attack

  ```