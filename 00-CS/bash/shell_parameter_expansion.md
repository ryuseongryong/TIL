- https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html

# 3.5.3 Shell Parameter Expansion

'$' 문자는 매개변수 확장, 명령 대체 또는 산술 확장을 도입합니다. 확장할 매개변수 이름이나 기호는 중괄호로 묶을 수 있는데, 이는 선택 사항이지만 이름의 일부로 해석될 수 있는 바로 뒤에 오는 문자로부터 확장할 변수를 보호하는 역할을 합니다.

중괄호를 사용할 때 일치하는 끝 중괄호는 백슬래시로 이스케이프되지 않은 첫 번째 '}'이거나 따옴표로 묶인 문자열 내이며, 내장된 산술 확장, 명령 대체 또는 매개변수 확장 내에서는 일치하지 않습니다.

매개변수 확장의 기본 형식은 ${parameter}입니다. 매개변수 값이 치환됩니다. 매개변수는 위에서 설명한 대로 셸 매개변수(셸 매개변수 참조) 또는 배열 참조(배열 참조)입니다. 매개 변수가 두 자리 이상의 위치 매개 변수이거나 매개 변수 뒤에 이름의 일부로 해석해서는 안 되는 문자가 오는 경우 중괄호가 필요합니다.

매개 변수의 첫 번째 문자가 느낌표(!)이고 매개 변수가 네임 레퍼런스가 아닌 경우 간접 지시 수준을 도입합니다. Bash는 원래 매개변수의 확장이 아니라 나머지 매개변수를 확장하여 형성된 값을 새 매개변수로 사용하고, 이 값을 확장한 다음 나머지 확장에 해당 값을 사용합니다. 이를 간접 확장이라고 합니다. 값은 물결표 확장, 매개변수 확장, 명령 대체 및 산술 확장의 적용을 받습니다. 매개변수가 이름 참조인 경우 전체 간접 확장을 수행하는 대신 매개변수가 참조하는 변수의 이름으로 확장됩니다. 예외적으로 아래에 설명된 ${!prefix*} 및 ${!name[@]}의 확장은 예외입니다. 간접 확장을 도입하려면 느낌표가 왼쪽 중괄호 바로 뒤에 와야 합니다.

아래 각 경우에서 단어는 물결표 확장, 매개변수 확장, 명령 대체 및 산술 확장의 적용을 받습니다.

아래 설명된 형식(예: ':-')을 사용하여 하위 문자열 확장을 수행하지 않을 경우 Bash는 설정되지 않은 매개변수 또는 null이 있는지 테스트합니다. 콜론을 생략하면 설정되지 않은 매개변수에 대해서만 테스트가 수행됩니다. 다시 말해, 콜론을 포함하면 연산자는 매개 변수의 존재 여부와 해당 값이 null이 아닌지 모두 테스트하고, 콜론을 생략하면 존재 여부만 테스트합니다.

- ${parameter:-word} : 파라미터가 설정되지 않았거나 null이면 단어의 확장이 대체됩니다. 그렇지 않으면 매개변수의 값으로 대체됩니다.
```
$ v=123
$ echo ${v-unset}
123

```

- ${parameter:=word} : 매개변수가 설정되지 않았거나 null인 경우, 단어의 확장이 매개변수에 할당됩니다. 그런 다음 매개변수의 값이 대체됩니다. 위치 매개변수와 특수 매개변수는 이러한 방식으로 할당할 수 없습니다.
```
$ var=
$ : ${var:=DEFAULT}
$ echo $var
DEFAULT

```

- ${parameter:?word} : 매개 변수가 널이거나 설정되지 않은 경우, 단어의 확장(또는 단어가 없는 경우 같은 내용의 메시지)이 표준 오류에 기록되고 대화형 셸이 아닌 경우 셸이 종료됩니다. 그렇지 않으면 파라미터의 값이 대체됩니다.
```
$ var=
$ : ${var:?var is unset or null}
bash: var: var is unset or null

```

- ${parameter:+word} : 매개변수가 널이거나 설정되지 않은 경우 아무것도 치환되지 않으며, 그렇지 않으면 단어의 확장이 치환됩니다.
```
$ var=123
$ echo ${var:+var is set and not null}
var is set and not null

```

- ${parameter:offset}
- ${parameter:offset:length}
이를 하위 문자열 확장이라고 합니다. 오프셋으로 지정된 문자에서 시작하여 매개변수 값의 최대 길이 문자까지 확장됩니다. 매개변수가 '@' 또는 '*', '@' 또는 '*'로 구분된 인덱싱 배열 또는 연관 배열 이름인 경우 결과는 아래와 같이 달라집니다. 길이가 생략된 경우, offset으로 지정된 문자에서 시작하여 값의 끝까지 확장되는 매개변수 값의 부분 문자열로 확장됩니다. 길이와 offset은 산술 표현식입니다(셸 산술 참조).

offset이 0보다 작은 숫자로 평가되면 해당 값은 매개변수 값의 끝에서 문자 단위로 오프셋으로 사용됩니다. 길이가 0보다 작은 숫자로 평가되면 문자 수가 아닌 매개변수 값의 끝에서 오프셋으로 해석되며, 확장은 오프셋과 해당 결과 사이의 문자로 해석됩니다. 음수 오프셋은 ':-' 확장과 혼동되지 않도록 콜론과 공백을 하나 이상 띄워야 한다는 점에 유의하세요.

다음은 매개변수와 하위 배열에 대한 부분 문자열 확장을 설명하는 몇 가지 예제입니다:
```
$ string=01234567890abcdefgh
$ echo ${string:7}
7890abcdefgh
$ echo ${string:7:0}

$ echo ${string:7:2}
78
$ echo ${string:7:-2}
7890abcdef
$ echo ${string: -7}
bcdefgh
$ echo ${string: -7:0}

$ echo ${string: -7:2}
bc
$ echo ${string: -7:-2}
bcdef
$ set -- 01234567890abcdefgh
$ echo ${1:7}
7890abcdefgh
$ echo ${1:7:0}

$ echo ${1:7:2}
78
$ echo ${1:7:-2}
7890abcdef
$ echo ${1: -7}
bcdefgh
$ echo ${1: -7:0}

$ echo ${1: -7:2}
bc
$ echo ${1: -7:-2}
bcdef
$ array[0]=01234567890abcdefgh
$ echo ${array[0]:7}
7890abcdefgh
$ echo ${array[0]:7:0}

$ echo ${array[0]:7:2}
78
$ echo ${array[0]:7:-2}
7890abcdef
$ echo ${array[0]: -7}
bcdefgh
$ echo ${array[0]: -7:0}

$ echo ${array[0]: -7:2}
bc
$ echo ${array[0]: -7:-2}
bcdef
```
매개변수가 '@' 또는 '*'인 경우 결과는 오프셋에서 시작하는 길이 위치 매개변수입니다. 오프셋은 가장 큰 위치 매개변수보다 큰 것을 기준으로 음수 오프셋을 취하므로 -1의 오프셋은 마지막 위치 매개변수로 평가됩니다. 길이가 0보다 작은 숫자로 평가되면 확장 오류입니다.

다음 예는 위치 매개변수를 사용한 부분 문자열 확장을 설명합니다:

```
$ set -- 1 2 3 4 5 6 7 8 9 0 a b c d e f g h
$ echo ${@:7}
7 8 9 0 a b c d e f g h
$ echo ${@:7:0}

$ echo ${@:7:2}
7 8
$ echo ${@:7:-2}
bash: -2: substring expression < 0
$ echo ${@: -7:2}
b c
$ echo ${@:0}
./bash 1 2 3 4 5 6 7 8 9 0 a b c d e f g h
$ echo ${@:0:2}
./bash 1
$ echo ${@: -7:0}
```
매개변수가 '@' 또는 '*'가 붙은 인덱싱된 배열 이름인 경우 결과는 ${parameter[offset]}로 시작하는 배열의 길이 멤버가 됩니다. 지정된 배열의 최대 인덱스보다 큰 것을 기준으로 음수 오프셋을 취합니다. 길이가 0보다 작은 숫자로 평가되면 확장 오류입니다.

이 예는 인덱싱된 배열에서 하위 문자열 확장을 사용하는 방법을 보여줍니다:
```
$ array=(0 1 2 3 4 5 6 7 8 9 0 a b c d e f g h)
$ echo ${array[@]:7}
7 8 9 0 a b c d e f g h
$ echo ${array[@]:7:2}
7 8
$ echo ${array[@]: -7:2}
b c
$ echo ${array[@]: -7:-2}
bash: -2: substring expression < 0
$ echo ${array[@]:0}
0 1 2 3 4 5 6 7 8 9 0 a b c d e f g h
$ echo ${array[@]:0:2}
0 1
$ echo ${array[@]: -7:0}

```

연관 배열에 하위 문자열 확장을 적용하면 정의되지 않은 결과가 생성됩니다.

하위 문자열 인덱싱은 위치 매개변수를 사용하지 않는 한 0을 기준으로 하며, 이 경우 인덱싱은 기본적으로 1에서 시작합니다. 오프셋이 0이고 위치 매개변수가 사용되는 경우 목록 앞에 $0이 접두사로 붙습니다.

${!prefix*}
${!prefix@}
이름이 접두사로 시작하는 변수 이름으로 확장되며, IFS 특수 변수의 첫 문자로 구분됩니다. '@'을 사용하고 큰따옴표 안에 확장이 표시되면 각 변수 이름이 별도의 단어로 확장됩니다.

${!name[@]}
${!name[*]}
이름이 배열 변수인 경우 이름에 할당된 배열 인덱스(키) 목록으로 확장됩니다. 이름이 배열이 아닌 경우 이름이 설정되어 있으면 0으로 확장되고 그렇지 않으면 null로 확장됩니다. '@'을 사용하고 큰따옴표 안에 확장이 표시되면 각 키는 별도의 단어로 확장됩니다.

${#parameter}
매개변수의 확장된 값의 문자 길이가 대체됩니다. 매개변수가 '*' 또는 '@'인 경우, 대체되는 값은 위치 매개변수의 수입니다. 매개변수가 '*' 또는 '@'로 구분된 배열 이름인 경우, 대체되는 값은 배열의 요소 수입니다. 매개변수에 음수가 붙은 인덱스 배열 이름인 경우 해당 숫자는 매개변수의 최대 인덱스보다 큰 1을 기준으로 해석되므로 음수 인덱스는 배열의 끝부터 카운트백되고 -1 인덱스는 마지막 요소를 참조합니다.

${parameter##word}
${parameter##word}
단어가 확장되어 패턴이 생성되고 아래에 설명된 규칙에 따라 일치합니다(패턴 일치 참조). 패턴이 매개변수의 확장된 값의 시작 부분과 일치하는 경우, 확장 결과는 가장 짧은 일치 패턴('#' 케이스) 또는 가장 긴 일치 패턴('##' 케이스)이 삭제된 매개변수의 확장된 값입니다. 매개변수가 '@' 또는 '*'인 경우 패턴 제거 연산이 각 위치 매개변수에 차례로 적용되며 확장은 그 결과 목록이 됩니다. 매개변수가 '@' 또는 '*'로 첨자된 배열 변수인 경우 패턴 제거 연산이 배열의 각 멤버에 차례로 적용되며 확장은 결과 목록이 됩니다.

${parameter%word}
$
${parameter%%word}

단어가 확장되어 패턴이 생성되고 아래에 설명된 규칙에 따라 일치합니다(패턴 일치 참조). 패턴이 매개변수 확장 값의 후행 부분과 일치하는 경우, 확장 결과는 가장 짧은 일치 패턴('%' 케이스) 또는 가장 긴 일치 패턴('%%' 케이스)이 삭제된 매개변수 값입니다. 매개변수가 '@' 또는 '*'인 경우 패턴 제거 연산이 각 위치 매개변수에 차례로 적용되며 확장은 그 결과 목록이 됩니다. 매개변수가 '@' 또는 '*'로 첨자된 배열 변수인 경우 패턴 제거 연산이 배열의 각 멤버에 차례로 적용되며 확장은 결과 목록이 됩니다.

${parameter/pattern/string}
${parameter//pattern/string}
${parameter/#pattern/string}
${parameter/%pattern/string}
파일 이름 확장과 마찬가지로 패턴이 확장되어 패턴을 생성합니다. 매개변수가 확장되고 해당 값에 대한 패턴의 가장 긴 일치 항목이 문자열로 대체됩니다. 문자열은 물결표 확장, 매개변수 및 변수 확장, 산술 확장, 명령 및 프로세스 치환, 따옴표 제거를 거칩니다. 일치는 아래에 설명된 규칙에 따라 수행됩니다(패턴 일치 참조).

위의 첫 번째 형식에서는 첫 번째 일치 항목만 바뀝니다. 매개변수와 패턴을 구분하는 슬래시가 두 개 있는 경우(위의 두 번째 형태), 패턴의 모든 일치 항목이 문자열로 바뀝니다. 패턴 앞에 '#'이 오는 경우(위의 세 번째 형태), 패턴은 매개변수의 확장된 값의 시작 부분에 일치해야 합니다. 패턴 앞에 '%'(위의 네 번째 형식)가 오는 경우, 매개변수의 확장된 값의 끝에서 일치해야 합니다. 문자열의 확장이 null이면 일치하는 패턴이 삭제됩니다. 문자열이 null이면 패턴의 일치 항목이 삭제되고 패턴 뒤의 '/'는 생략될 수 있습니다.

shopt를 사용하여 patsub_replacement 셸 옵션을 활성화하면 문자열에서 따옴표로 묶이지 않은 '&' 인스턴스가 패턴의 일치하는 부분으로 대체됩니다. 이는 일반적인 sed 관용구를 복제하기 위한 것입니다.

문자열의 일부를 따옴표로 묶으면 셸 변수에 저장된 대체 문자열을 포함하여 따옴표로 묶인 부분의 확장에서 대체가 금지됩니다. 백슬래시는 문자열의 '&'를 이스케이프 처리하며, 대체 문자열에 리터럴 '&'를 허용하기 위해 백슬래시가 제거됩니다. 백슬래시는 큰따옴표 안에 특별한 의미가 있으므로 문자열이 큰따옴표로 묶인 경우 백슬래시와 큰따옴표 간의 원치 않는 상호 작용을 피하기 위해 주의해야 합니다. 패턴 대체는 문자열을 확장한 후 따옴표로 묶이지 않은 '&'를 검사하므로 사용자는 대체 문자열에서 문자 그대로 사용할 '&'는 적절하게 따옴표로 묶고 대체하려는 '&'의 인스턴스는 따옴표로 묶지 않도록 해야 합니다.

예를 들어

```
var=abcdef
rep='& '
echo ${var/abc/& }
echo "${var/abc/& }"
echo ${var/abc/$rep}
echo "${var/abc/$rep}"
```

는 "abc def"의 네 줄을 표시하고

```
var=abcdef
rep='& '
echo ${var/abc/\& }
echo "${var/abc/\& }"
echo ${var/abc/"& "}
echo ${var/abc/"$rep"}

```
는 네 줄의 "& def"를 표시합니다. 패턴 제거 연산자와 마찬가지로 대체 문자열을 둘러싼 큰따옴표는 확장된 문자를 인용하지만, 전체 매개변수 치환을 둘러싼 큰따옴표는 그렇지 않은데, 이는 둘러싸는 큰따옴표를 고려하지 않는 컨텍스트에서 확장이 수행되므로 확장된 문자를 인용하지 않습니다.

백슬래시는 '&'를 이스케이프 처리할 수 있으므로 대체 문자열의 백슬래시도 이스케이프 처리할 수 있습니다. 즉, '\\'는 대체 문자열에 리터럴 백슬래시를 삽입하므로 다음 두 개의 에코 명령은 다음과 같습니다.

```
var=abcdef
rep='\\&xyz'
echo ${var/abc/\\&xyz}
echo ${var/abc/$rep}

```
는 둘 다 '\abcxyzdef'를 출력합니다.

문자열만 큰따옴표로 묶을 필요는 거의 없습니다.

nocasematch 셸 옵션(샵트 빌트인의 샵트 설명 참조)을 활성화하면 알파벳 문자의 대소문자에 관계없이 일치가 수행됩니다. 매개변수가 '@' 또는 '*'인 경우 치환 연산은 각 위치 매개변수에 차례로 적용되며, 확장은 결과 목록이 됩니다. 매개변수가 '@' 또는 '*'로 첨자된 배열 변수인 경우, 치환 연산은 배열의 각 멤버에 차례로 적용되며 확장은 결과 목록이 됩니다.

${parameter^pattern}
${parameter^^pattern}
${parameter,pattern}
${parameter,,pattern}
이 확장은 매개변수에서 알파벳 문자의 대소문자를 수정합니다. 파일 이름 확장에서와 마찬가지로 패턴이 확장되어 패턴을 생성합니다. 확장된 매개변수 값의 각 문자는 패턴과 비교하여 테스트되고 패턴과 일치하는 경우 대소문자가 변환됩니다. 패턴은 두 개 이상의 문자와 일치하려고 시도해서는 안 됩니다.

'^' 연산자는 패턴과 일치하는 소문자를 대문자로 변환하고, ',' 연산자는 패턴과 일치하는 대문자를 소문자로 변환합니다. '^^' 및 ',,' 확장은 확장된 값에서 일치하는 각 문자를 변환하고, '^' 및 ',' 확장은 확장된 값에서 첫 번째 문자만 일치하여 변환합니다. 패턴을 생략하면 모든 문자와 일치하는 '?'처럼 처리됩니다.

매개변수가 '@' 또는 '*'인 경우 대소문자 수정 연산이 각 위치 매개변수에 차례로 적용되며, 확장은 결과 목록이 됩니다. 매개변수가 '@' 또는 '*'로 첨자된 배열 변수인 경우 배열의 각 멤버에 대/소문자 수정 연산이 차례로 적용되며 확장은 결과 목록이 됩니다.

${parameter@operator}
확장은 연산자 값에 따라 매개변수 값의 변환이거나 매개변수 자체에 대한 정보입니다. 각 연산자는 단일 문자입니다:

U
확장자는 소문자 알파벳을 대문자로 변환한 매개변수 값인 문자열입니다.

u
확장은 매개변수가 알파벳인 경우 첫 번째 문자가 대문자로 변환된 값인 문자열입니다.

L
확장자는 대문자 알파벳이 소문자로 변환된 매개변수 값인 문자열입니다.

Q
확장은 입력으로 재사용할 수 있는 형식으로 따옴표로 묶인 매개변수 값인 문자열입니다.

E
확장은 $ '...' 인용 메커니즘과 같이 백슬래시 이스케이프 시퀀스가 확장된 매개변수의 값인 문자열입니다.

P
확장은 매개변수 값을 프롬프트 문자열처럼 확장한 결과인 문자열입니다(프롬프트 제어하기 참조).

A
확장은 할당 문 또는 선언 명령 형식의 문자열로, 평가되면 해당 속성과 값으로 매개변수를 다시 생성합니다.

K
인덱싱된 배열 및 연관 배열의 값을 따옴표로 묶인 키-값 쌍의 시퀀스로 인쇄한다는 점을 제외하면 매개변수 값의 따옴표로 묶인 버전을 생성합니다(배열 참조).

a
확장은 매개변수의 속성을 나타내는 플래그 값으로 구성된 문자열입니다.

k
'K' 변환과 비슷하지만, 단어 분할 후 인덱스 배열 및 연관 배열의 키와 값을 별도의 단어로 확장합니다.

매개변수가 '@' 또는 '*'인 경우, 연산은 각 위치 매개변수에 차례로 적용되며, 확장은 결과 목록이 됩니다. 매개변수에 '@' 또는 '*'가 붙은 배열 변수인 경우, 연산은 배열의 각 멤버에 차례로 적용되며 확장은 결과 목록이 됩니다.

확장 결과는 아래에 설명된 대로 단어 분할 및 파일 이름 확장의 영향을 받습니다.

